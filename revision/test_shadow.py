import time
import numpy as np
from shapely.geometry import Polygon, MultiPolygon
from simple_shadow import SimpleShadow
from plotting_functions import plot_poly
import matplotlib.pyplot as plt
import os
from dotenv import load_dotenv
from hybrid.sites import SiteInfo
from hybrid.sites import flatirons_site as sample_site
from hybrid.keys import set_developer_nrel_gov_key
import json
from init_plant import init_hybrid_plant

# Set API key
load_dotenv()
NREL_API_KEY = os.getenv("NREL_API_KEY")
set_developer_nrel_gov_key(NREL_API_KEY)  # Set this key manually here if you are not setting it using the .env

powercurve_filename = 'turbine_data/high_7r_200d_135h.txt'
rotor_diameter = 200.0
hub_height = 135.0
turbine_rating = 7.0

# Get resource
lat = 40.966
lon = -84.598
year = 2012

sample_site['year'] = year
sample_site['lat'] = lat
sample_site['lon'] = lon

# Import powercurve
powercurve_file = open(powercurve_filename)
powercurve_data = json.load(powercurve_file)
powercurve_file.close()

site = SiteInfo(sample_site, hub_height=hub_height)

turbine_x = np.array([0.0])
turbine_y = np.array([0.0])


tower_width = 6.0
latitide = 40.966

shadow = SimpleShadow(hub_height, rotor_diameter, tower_width, latitide,  min_time=7, max_time=17)

coord = 250
solar_poly = Polygon(((-coord,-coord),(-coord,coord),(coord,coord),(coord,-coord)))
shadow.solar_polygons = MultiPolygon([solar_poly])

wind_capacity_kw = np.max(powercurve_data['turbine_powercurve_specification']['turbine_power_output'])
solar_capacity_kw = solar_poly.area/1E6*4000.0
wind_plant, solar_plant = init_hybrid_plant(site, rotor_diameter, hub_height, powercurve_data, wind_capacity_kw, solar_capacity_kw)
wind_plant.modify_coordinates(turbine_x,turbine_y)

solar_plant.system_model.execute(0)

wind_power = wind_plant.system_model.Outputs.gen
solar_power_no_losses = solar_plant.system_model.Outputs.gen

shadow.solar_polygons = solar_poly

N = 21
side = 6*rotor_diameter
x_locs = np.linspace(-side,side,N)
y_locs = np.linspace(-side,side,N)

totals = np.zeros((N,N))
maxs = np.zeros((N,N))
nums = np.zeros((N,N))

# time_array = np.arange(len(solar_power_no_losses))
# for i in range(N):
#     print(i)
#     for j in range(N):
#         shadow.turbine_x = [x_locs[i]]
#         shadow.turbine_y = [y_locs[j]]
#         solar_power_with_losses = np.zeros_like(solar_power_no_losses)
#         for k in range(len(solar_power_no_losses)):
#             t = time_array[k]%24.0
#             d = time_array[k]/24.0
#             shadow_losses = shadow.calculate_losses(t,d)
#             solar_power_with_losses[k] = solar_power_no_losses[k] * (1-shadow_losses)
#         totals[i,j] = np.sum(solar_power_with_losses)/np.sum(solar_power_no_losses)
#         ind = np.argmax(solar_power_no_losses-solar_power_with_losses)
#         if solar_power_with_losses[ind] == 0.0:
#             maxs[i,j] = 1.0
#         else:
#             maxs[i,j] = solar_power_with_losses[ind]/solar_power_no_losses[ind]
#         nums[i,j] = len([element for element in solar_power_no_losses-solar_power_with_losses if element > 0.01])
#     print("totals: ", repr(totals))
#     print("maxs: ", repr(maxs))
#     print("nums: ", repr(nums))

# totals = np.array([[0.99947232, 0.99882451, 0.99813517, 0.99779994, 0.99804552,
#         0.99831047, 0.99843864, 0.99863027, 0.99874639, 0.99904338,
#         0.99962018, 0.99997325, 1.        , 1.        , 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.9997807 , 0.9992045 , 0.99837944, 0.99756158, 0.99730104,
#         0.99753666, 0.9976796 , 0.9979878 , 0.99838347, 0.99863472,
#         0.99923703, 0.99984159, 1.        , 1.        , 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.99995788, 0.999628  , 0.9988504 , 0.99779463, 0.99689683,
#         0.99663899, 0.9967203 , 0.99690485, 0.99753769, 0.99811076,
#         0.99867691, 0.99953024, 0.99998891, 1.        , 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 0.99990281, 0.99940667, 0.99836998, 0.9970835 ,
#         0.996089  , 0.99565352, 0.99551558, 0.99598527, 0.99703145,
#         0.99787568, 0.99893368, 0.99984644, 1.        , 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 0.99999824, 0.99981553, 0.99899961, 0.99734917,
#         0.99567162, 0.99436822, 0.99341995, 0.99355376, 0.99482412,
#         0.99625678, 0.99783024, 0.99934565, 0.99999993, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 0.99998854, 0.99957476, 0.99775125,
#         0.99505817, 0.99245719, 0.99011922, 0.98890454, 0.99007569,
#         0.99270403, 0.99522976, 0.99810109, 0.99988826, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.99986395, 0.998491  ,
#         0.9951493 , 0.99056502, 0.9856265 , 0.98061868, 0.98056916,
#         0.98497543, 0.98986806, 0.99592662, 0.99973081, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.99989738, 0.99894292,
#         0.99568635, 0.98869235, 0.97882513, 0.96561599, 0.96263523,
#         0.96891361, 0.97830637, 0.99211666, 0.99969854, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.99996781, 0.99934542,
#         0.99670196, 0.98857227, 0.97456461, 0.95266114, 0.94836213,
#         0.95530505, 0.96795705, 0.99045248, 0.99969854, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 1.        , 0.99988549,
#         0.99816397, 0.98932683, 0.97151306, 0.94092782, 0.93518759,
#         0.94236356, 0.95800642, 0.98899541, 0.99978125, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 1.        , 1.        ,
#         0.99868577, 0.98918949, 0.96911173, 0.93486797, 0.92793309,
#         0.93554142, 0.95313963, 0.98782436, 0.99990709, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 1.        , 0.99990975,
#         0.99835675, 0.98984069, 0.97239861, 0.94285647, 0.93757385,
#         0.94446294, 0.95975686, 0.98978701, 0.99983014, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.99997804, 0.99947673,
#         0.99718396, 0.98964819, 0.97631052, 0.95590048, 0.9522146 ,
#         0.95860974, 0.97063023, 0.99166788, 0.99976707, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.99992998, 0.99918671,
#         0.99645424, 0.99007061, 0.98094071, 0.96920523, 0.9667115 ,
#         0.97239973, 0.98110619, 0.9933854 , 0.99976699, 0.99999996,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.99991412, 0.99891531,
#         0.99620734, 0.99211565, 0.98784844, 0.98378111, 0.98380476,
#         0.98772158, 0.99199013, 0.99684339, 0.99979255, 0.99999988,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 0.99999529, 0.99976214, 0.99847205,
#         0.99634045, 0.99412447, 0.99231456, 0.99143069, 0.99240558,
#         0.99464806, 0.99658894, 0.99861916, 0.9999144 , 0.9999998 ,
#         0.99999999, 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 0.99999933, 0.99991464, 0.99945023, 0.998327  ,
#         0.99704091, 0.99595888, 0.99529313, 0.99540798, 0.99637913,
#         0.99753843, 0.99857759, 0.99953824, 0.99999961, 0.99999972,
#         0.99999991, 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 0.99995919, 0.99971449, 0.99912214, 0.99827713,
#         0.99748817, 0.99709938, 0.99702009, 0.99732726, 0.99811811,
#         0.99873503, 0.99932695, 0.99989082, 0.99999966, 0.99999966,
#         0.99999983, 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.99998338, 0.99983467, 0.99944148, 0.99883519, 0.99821995,
#         0.99795201, 0.99796854, 0.99807959, 0.99851203, 0.99893859,
#         0.99925136, 0.99971659, 0.99999191, 0.99999966, 0.99999966,
#         0.99999975, 0.99999994, 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.99990921, 0.99964423, 0.99922476, 0.99874174, 0.99851481,
#         0.99859529, 0.99865334, 0.9988454 , 0.99912506, 0.99926914,
#         0.99958333, 0.99990913, 0.99999977, 0.99999966, 0.99999966,
#         0.99999967, 0.99999986, 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.99977912, 0.99948183, 0.99912468, 0.99890475, 0.9989933 ,
#         0.99908927, 0.9991467 , 0.9992725 , 0.99934323, 0.9994939 ,
#         0.99979594, 0.99998456, 0.99999985, 0.99999966, 0.99999966,
#         0.99999966, 0.99999978, 0.99999997, 1.        , 1.        ,
#         1.        ]])
# maxs = np.array([[0.84904338, 0.7055803 , 0.57902041, 0.57537482, 0.68736801,
#         0.77585236, 0.61204201, 0.61972154, 0.61972154, 0.67442142,
#         0.87587729, 0.98887022, 1.        , 1.        , 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.91577407, 0.80793159, 0.6497278 , 0.63392778, 0.58596352,
#         0.65983342, 0.79280434, 0.60173897, 0.60167794, 0.62836854,
#         0.78850998, 0.95405186, 1.        , 1.        , 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.97937389, 0.90987952, 0.83157343, 0.67227314, 0.56657071,
#         0.61497655, 0.67839218, 0.6043534 , 0.59720154, 0.60503547,
#         0.70539822, 0.90350391, 0.9959461 , 1.        , 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 0.97290146, 0.87576698, 0.76730603, 0.66341845,
#         0.56916421, 0.5823108 , 0.71306945, 0.60572139, 0.60582397,
#         0.69379817, 0.84159639, 0.97339582, 1.        , 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 0.99866743, 0.95788524, 0.87453145, 0.74913589,
#         0.60325984, 0.54890088, 0.60555427, 0.7160018 , 0.63047954,
#         0.63047954, 0.7690265 , 0.93820854, 0.99996693, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 0.99655472, 0.95449668, 0.87524872,
#         0.69930081, 0.63246613, 0.58267721, 0.62233938, 0.74092416,
#         0.61771704, 0.68437256, 0.88754201, 0.99014771, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.97292871, 0.86632327,
#         0.7518223 , 0.67871653, 0.59647481, 0.59618714, 0.65021582,
#         0.77228861, 0.6584959 , 0.83967847, 0.97313555, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.97292871, 0.86632327,
#         0.74987624, 0.6644361 , 0.71685714, 0.71685444, 0.65952014,
#         0.71716147, 0.81733909, 0.79795068, 0.96821403, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.99183691, 0.92331023,
#         0.81319576, 0.74561442, 0.71680933, 0.71416933, 0.76478015,
#         0.72807043, 0.79924315, 0.79258869, 0.96821403, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 1.        , 0.98487967,
#         0.93507506, 0.85001755, 0.78690378, 0.77918501, 0.78045211,
#         0.82106937, 0.804099  , 0.90827914, 0.97522447, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 1.        , 1.        ,
#         0.94667831, 0.86907827, 0.85745495, 0.85481495, 0.85481495,
#         0.85875669, 0.88185213, 0.92357986, 0.99268147, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 1.        , 0.9857953 ,
#         0.93506475, 0.84683696, 0.7849904 , 0.77961734, 0.78079434,
#         0.82156325, 0.80437604, 0.90863898, 0.97614004, 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.99183008, 0.92634853,
#         0.8214814 , 0.72990597, 0.69963967, 0.71160443, 0.76636229,
#         0.82156325, 0.7991292 , 0.79237702, 0.9690486 , 1.        ,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.97290269, 0.87679635,
#         0.7581816 , 0.68014822, 0.66252023, 0.71430276, 0.65129186,
#         0.71107203, 0.81814765, 0.79390166, 0.9690486 , 0.99936321,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 1.        , 0.97290269, 0.87679635,
#         0.76020189, 0.70600901, 0.69762224, 0.60285526, 0.66194978,
#         0.77386774, 0.69874005, 0.84032728, 0.97359981, 0.99829643,
#         1.        , 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 1.        , 0.99655472, 0.97290269, 0.88509428,
#         0.81713912, 0.61851255, 0.57455183, 0.62727983, 0.75582785,
#         0.61716465, 0.68502549, 0.88847901, 0.99011982, 0.99710899,
#         0.99982086, 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 0.99895694, 0.96588713, 0.85559931, 0.7432791 ,
#         0.5995653 , 0.62162266, 0.61397366, 0.71764773, 0.62536098,
#         0.62536098, 0.76210112, 0.93785869, 0.99505235, 0.99592155,
#         0.99860969, 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [1.        , 0.97290146, 0.89320468, 0.73951817, 0.65408597,
#         0.5621674 , 0.58234196, 0.72361067, 0.82747834, 0.63200424,
#         0.64134534, 0.84248568, 0.97336574, 0.99505235, 0.99505235,
#         0.99761412, 1.        , 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.98147466, 0.90429681, 0.78795673, 0.63145575, 0.63276649,
#         0.59783363, 0.67699096, 0.81027935, 0.59711548, 0.60949163,
#         0.7057176 , 0.90481977, 0.99605615, 0.99505235, 0.99505235,
#         0.99642668, 0.99906735, 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.9370995 , 0.84611802, 0.68819841, 0.57150158, 0.55614045,
#         0.70821724, 0.79175214, 0.59782532, 0.59782532, 0.63378643,
#         0.80181272, 0.95393959, 0.9964531 , 0.99505235, 0.99505235,
#         0.99523924, 0.99785618, 1.        , 1.        , 1.        ,
#         1.        ],
#        [0.84904338, 0.76618283, 0.63386386, 0.57537482, 0.64277967,
#         0.79255246, 0.61915582, 0.59078113, 0.61083919, 0.6807972 ,
#         0.87184816, 0.98792005, 0.99764054, 0.99505235, 0.99505235,
#         0.99505235, 0.99693181, 0.999525  , 1.        , 1.        ,
#         1.        ]])

# nums = np.array([[5.900e+01, 7.000e+01, 8.300e+01, 9.400e+01, 1.340e+02, 1.500e+02,
#         1.700e+02, 1.680e+02, 9.000e+01, 8.500e+01, 7.300e+01, 4.100e+01,
#         0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [5.900e+01, 7.000e+01, 8.300e+01, 9.600e+01, 1.430e+02, 1.660e+02,
#         1.860e+02, 2.120e+02, 1.710e+02, 1.050e+02, 9.100e+01, 6.600e+01,
#         0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [4.900e+01, 7.000e+01, 8.300e+01, 9.600e+01, 1.300e+02, 1.830e+02,
#         2.060e+02, 2.420e+02, 2.570e+02, 1.880e+02, 1.140e+02, 9.600e+01,
#         4.300e+01, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 6.400e+01, 8.300e+01, 9.600e+01, 1.150e+02, 1.890e+02,
#         2.320e+02, 2.770e+02, 3.110e+02, 2.830e+02, 2.190e+02, 1.340e+02,
#         8.800e+01, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 3.100e+01, 8.000e+01, 1.360e+02, 1.890e+02, 2.600e+02,
#         3.330e+02, 4.030e+02, 4.830e+02, 4.340e+02, 3.730e+02, 2.760e+02,
#         1.780e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 5.500e+01, 1.350e+02, 1.950e+02, 2.590e+02,
#         3.990e+02, 5.180e+02, 6.680e+02, 6.670e+02, 5.700e+02, 4.080e+02,
#         2.570e+02, 1.040e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 0.000e+00, 1.200e+02, 1.940e+02, 3.340e+02,
#         5.410e+02, 7.830e+02, 1.002e+03, 1.002e+03, 9.960e+02, 6.990e+02,
#         3.900e+02, 1.040e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 0.000e+00, 4.000e+01, 1.810e+02, 3.490e+02,
#         6.550e+02, 1.250e+03, 1.692e+03, 1.709e+03, 1.708e+03, 1.476e+03,
#         8.400e+02, 1.040e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 0.000e+00, 4.000e+01, 8.000e+01, 3.440e+02,
#         8.410e+02, 2.033e+03, 3.282e+03, 3.282e+03, 3.281e+03, 3.275e+03,
#         3.156e+03, 1.040e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 7.600e+01, 3.110e+02,
#         1.019e+03, 2.756e+03, 3.716e+03, 3.720e+03, 3.719e+03, 3.714e+03,
#         3.511e+03, 1.020e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 4.040e+02,
#         9.960e+02, 2.842e+03, 3.731e+03, 3.735e+03, 3.735e+03, 3.728e+03,
#         3.517e+03, 1.710e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 7.000e+01, 3.060e+02,
#         9.890e+02, 2.733e+03, 3.721e+03, 3.724e+03, 3.722e+03, 3.719e+03,
#         3.516e+03, 1.050e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 0.000e+00, 3.400e+01, 7.600e+01, 3.240e+02,
#         8.230e+02, 1.992e+03, 3.299e+03, 3.302e+03, 3.303e+03, 3.297e+03,
#         3.156e+03, 1.060e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 0.000e+00, 3.400e+01, 1.580e+02, 3.300e+02,
#         6.250e+02, 1.209e+03, 1.650e+03, 1.672e+03, 1.673e+03, 1.429e+03,
#         8.450e+02, 1.060e+02, 2.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 0.000e+00, 9.600e+01, 1.770e+02, 3.160e+02,
#         5.030e+02, 7.450e+02, 9.620e+02, 9.620e+02, 9.590e+02, 6.810e+02,
#         3.930e+02, 1.070e+02, 4.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 0.000e+00, 4.100e+01, 1.140e+02, 1.780e+02, 2.410e+02,
#         3.610e+02, 4.830e+02, 6.330e+02, 6.300e+02, 5.500e+02, 4.000e+02,
#         2.590e+02, 1.070e+02, 4.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 1.600e+01, 6.300e+01, 1.160e+02, 1.700e+02, 2.180e+02,
#         2.930e+02, 3.630e+02, 4.410e+02, 4.010e+02, 3.520e+02, 2.730e+02,
#         1.820e+02, 5.000e+00, 5.000e+00, 4.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [0.000e+00, 5.300e+01, 6.900e+01, 8.200e+01, 1.020e+02, 1.560e+02,
#         1.970e+02, 2.410e+02, 2.770e+02, 2.500e+02, 1.920e+02, 1.280e+02,
#         9.100e+01, 5.000e+00, 5.000e+00, 4.000e+00, 0.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [3.900e+01, 5.500e+01, 6.900e+01, 8.200e+01, 1.100e+02, 1.500e+02,
#         1.730e+02, 2.090e+02, 2.230e+02, 1.660e+02, 1.010e+02, 9.400e+01,
#         4.500e+01, 5.000e+00, 5.000e+00, 5.000e+00, 3.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [4.700e+01, 5.500e+01, 6.900e+01, 8.200e+01, 1.140e+02, 1.320e+02,
#         1.530e+02, 1.790e+02, 1.430e+02, 8.500e+01, 8.000e+01, 6.500e+01,
#         4.000e+00, 5.000e+00, 5.000e+00, 5.000e+00, 4.000e+00, 0.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00],
#        [4.700e+01, 5.500e+01, 6.900e+01, 8.100e+01, 1.040e+02, 1.170e+02,
#         1.370e+02, 1.340e+02, 6.800e+01, 6.800e+01, 6.100e+01, 3.800e+01,
#         4.000e+00, 5.000e+00, 5.000e+00, 5.000e+00, 4.000e+00, 1.000e+00,
#         0.000e+00, 0.000e+00, 0.000e+00]])


# 1/3 rotor
totals = np.array([[0.99982411, 0.99960631, 0.99937226, 0.99926012, 0.99934095,
        0.99942795, 0.99947326, 0.99953829, 0.99957771, 0.99967929,
        0.99987336, 0.99999108, 1.        , 1.        , 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [0.9999269 , 0.99973297, 0.99945357, 0.9991754 , 0.99908807,
        0.9991655 , 0.99921444, 0.9993229 , 0.99945548, 0.99954135,
        0.99974507, 0.9999472 , 1.        , 1.        , 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [0.99998596, 0.99987441, 0.99961083, 0.99925206, 0.99894689,
        0.99886035, 0.99888778, 0.99895428, 0.9991722 , 0.9993647 ,
        0.99955703, 0.99984341, 0.9999963 , 1.        , 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 0.9999676 , 0.9997982 , 0.99944579, 0.9990074 ,
        0.99866905, 0.99852322, 0.99848038, 0.99864586, 0.99900295,
        0.99928771, 0.99964425, 0.99994881, 1.        , 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 0.99999941, 0.99993797, 0.99965921, 0.99909949,
        0.9985261 , 0.99808381, 0.99776839, 0.99782094, 0.9982577 ,
        0.99874506, 0.99927501, 0.99978188, 0.99999998, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 0.99999618, 0.99985604, 0.99923863,
        0.99832411, 0.9974372 , 0.99664875, 0.99624952, 0.99665589,
        0.99755168, 0.9984055 , 0.99936701, 0.99996275, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99995465, 0.99949195,
        0.9983564 , 0.99678281, 0.99510601, 0.99343024, 0.99343019,
        0.99494278, 0.99660751, 0.99864051, 0.99991027, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99996579, 0.99964764,
        0.99854465, 0.99614474, 0.99274309, 0.98828381, 0.98729759,
        0.98944769, 0.99269011, 0.99736666, 0.99989951, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99998927, 0.99978181,
        0.99889242, 0.99609461, 0.99111756, 0.98302396, 0.98159027,
        0.98396799, 0.98844994, 0.99667417, 0.99989951, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 1.        , 0.99996183,
        0.99938104, 0.99634944, 0.98996673, 0.97859562, 0.97667978,
        0.97912858, 0.98471102, 0.99617056, 0.99992708, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 1.        , 1.        ,
        0.99956192, 0.99630621, 0.98913162, 0.97651827, 0.97419864,
        0.97678531, 0.98305758, 0.99577846, 0.99996903, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 1.        , 0.99996992,
        0.99944697, 0.99652965, 0.99028202, 0.979265  , 0.97750145,
        0.97984887, 0.98530347, 0.99643544, 0.99994333, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99999268, 0.99982558,
        0.99905535, 0.99646805, 0.99173425, 0.98416515, 0.98293561,
        0.98511978, 0.98937286, 0.99708235, 0.99992225, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99997666, 0.9997289 ,
        0.99880692, 0.99662254, 0.9934817 , 0.98952279, 0.98869513,
        0.99063701, 0.99363599, 0.99779063, 0.99992217, 0.99999996,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99997137, 0.99963606,
        0.99871957, 0.99732113, 0.99587601, 0.99451521, 0.99453269,
        0.99587098, 0.99731945, 0.9989463 , 0.99993064, 0.99999988,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 0.99999843, 0.99991979, 0.99948503,
        0.99876444, 0.99801263, 0.99740333, 0.99711113, 0.9974454 ,
        0.99820536, 0.99886024, 0.99953948, 0.99997124, 0.9999998 ,
        0.99999999, 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 0.99999978, 0.99997134, 0.99981359, 0.99943445,
        0.99899766, 0.99863211, 0.99841022, 0.99845226, 0.99878335,
        0.99917592, 0.9995247 , 0.99984585, 0.99999964, 0.99999972,
        0.99999991, 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 0.9999864 , 0.99990329, 0.99970286, 0.99941645,
        0.99914963, 0.9990198 , 0.99899442, 0.99910113, 0.99936944,
        0.99957624, 0.99977533, 0.99996338, 0.99999966, 0.99999966,
        0.99999983, 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [0.99999446, 0.99994427, 0.99981154, 0.99960646, 0.99939835,
        0.99930916, 0.99931459, 0.9993536 , 0.99950127, 0.99964375,
        0.99974942, 0.99990545, 0.99999709, 0.99999966, 0.99999966,
        0.99999975, 0.99999994, 1.        , 1.        , 1.        ,
        1.        ],
       [0.99996974, 0.99988068, 0.9997392 , 0.99957572, 0.99950003,
        0.99952677, 0.9995463 , 0.99961276, 0.99970624, 0.99975475,
        0.99986077, 0.99996969, 0.99999977, 0.99999966, 0.99999966,
        0.99999967, 0.99999986, 1.        , 1.        , 1.        ,
        1.        ],
       [0.99992637, 0.99982655, 0.99970588, 0.99963237, 0.99966178,
        0.99969351, 0.99971337, 0.99975581, 0.99977943, 0.99983037,
        0.99993196, 0.99999485, 0.99999985, 0.99999966, 0.99999966,
        0.99999966, 0.99999978, 0.99999997, 1.        , 1.        ,
        1.        ]])
maxs = np.array([[0.94968113, 0.9018601 , 0.85845461, 0.85827569, 0.89578934,
        0.92528412, 0.86821589, 0.87312656, 0.87312656, 0.89135985,
        0.95862576, 0.99629007, 1.        , 1.        , 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [0.97192469, 0.9359772 , 0.88202374, 0.87775375, 0.86162585,
        0.88624915, 0.93093478, 0.86665276, 0.86663241, 0.87552928,
        0.92950333, 0.98468395, 1.        , 1.        , 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [0.99312463, 0.96995984, 0.94385781, 0.89053553, 0.85381697,
        0.87122106, 0.8923596 , 0.86704462, 0.86466066, 0.86727197,
        0.90167931, 0.96783464, 0.9986487 , 1.        , 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 0.99096715, 0.95737013, 0.92221316, 0.86952394,
        0.85465718, 0.85903938, 0.90421091, 0.86702099, 0.86705519,
        0.89786547, 0.94713155, 0.99113194, 1.        , 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 0.99955581, 0.98591111, 0.95795497, 0.91581002,
        0.86526467, 0.84660964, 0.86717548, 0.90445933, 0.87645853,
        0.87645853, 0.92294854, 0.97940285, 0.99998898, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 0.99885157, 0.98474794, 0.95841624,
        0.89727832, 0.87575746, 0.85885951, 0.87208023, 0.91289156,
        0.87190363, 0.89456186, 0.96250894, 0.9967159 , 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99097624, 0.95544109,
        0.91608184, 0.89022159, 0.86230041, 0.86290146, 0.88164464,
        0.92305569, 0.88575085, 0.94645902, 0.99104518, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99097624, 0.95544109,
        0.91543315, 0.88241025, 0.9024321 , 0.9024294 , 0.88458022,
        0.90379399, 0.93839937, 0.93229615, 0.98940468, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99727897, 0.97443674,
        0.9366784 , 0.91339042, 0.90238429, 0.89974429, 0.91769453,
        0.9076564 , 0.93238729, 0.93021798, 0.98940468, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 1.        , 0.99495989,
        0.97835835, 0.94860469, 0.92682907, 0.92249615, 0.92483651,
        0.9379021 , 0.93400591, 0.96942374, 0.99174149, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 1.        , 1.        ,
        0.9822261 , 0.95495826, 0.95012622, 0.94748622, 0.94748622,
        0.95116722, 0.95964862, 0.97452398, 0.99756049, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 1.        , 0.9952651 ,
        0.97835492, 0.94748169, 0.9260541 , 0.92250309, 0.9232329 ,
        0.9380188 , 0.93408974, 0.96953052, 0.99204668, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99727669, 0.97544951,
        0.93970408, 0.90379269, 0.89572768, 0.898815  , 0.91808474,
        0.9380188 , 0.93234079, 0.93015458, 0.98968287, 1.        ,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99096756, 0.95893212,
        0.91830626, 0.89067302, 0.88304925, 0.90151333, 0.88141205,
        0.90241239, 0.93902148, 0.93106762, 0.98968287, 0.99936321,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 1.        , 0.99096756, 0.95893212,
        0.91897969, 0.89965339, 0.8968578 , 0.86542339, 0.88585194,
        0.92352806, 0.89955354, 0.94667179, 0.99119994, 0.99829643,
        1.        , 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 1.        , 0.99885157, 0.99096756, 0.96169809,
        0.93858447, 0.87080451, 0.85590645, 0.87348244, 0.91811072,
        0.8716603 , 0.89479438, 0.9628231 , 0.99670661, 0.99710899,
        0.99982086, 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 0.99965231, 0.98862904, 0.95018522, 0.91364455,
        0.86381995, 0.8575522 , 0.87010573, 0.90478297, 0.87470371,
        0.87470371, 0.92057665, 0.97928623, 0.99505235, 0.99592155,
        0.99860969, 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [1.        , 0.99096715, 0.96440156, 0.91149151, 0.88391351,
        0.85215035, 0.8588752 , 0.90783892, 0.94249278, 0.86811268,
        0.88014653, 0.94749523, 0.99112191, 0.99505235, 0.99505235,
        0.99761412, 1.        , 1.        , 1.        , 1.        ,
        1.        ],
       [0.99382489, 0.96809894, 0.92931891, 0.8754707 , 0.87698433,
        0.86534005, 0.89172582, 0.93675978, 0.86446825, 0.86859363,
        0.90190587, 0.96827326, 0.99868538, 0.99505235, 0.99505235,
        0.99642668, 0.99906735, 1.        , 1.        , 1.        ,
        1.        ],
       [0.97903317, 0.94870601, 0.89606614, 0.85560289, 0.85048252,
        0.90273908, 0.93058405, 0.86519484, 0.86519484, 0.87718188,
        0.93393757, 0.98464653, 0.9964531 , 0.99505235, 0.99505235,
        0.99523924, 0.99785618, 1.        , 1.        , 1.        ,
        1.        ],
       [0.94968113, 0.92206094, 0.87795462, 0.85827569, 0.88074398,
        0.93085082, 0.87180474, 0.86234651, 0.86323878, 0.89334212,
        0.95728272, 0.99597335, 0.99764054, 0.99505235, 0.99505235,
        0.99505235, 0.99693181, 0.999525  , 1.        , 1.        ,
        1.        ]])
nums = np.array([[5.900e+01, 7.000e+01, 8.300e+01, 9.400e+01, 1.340e+02, 1.490e+02,
        1.700e+02, 1.650e+02, 8.900e+01, 8.400e+01, 7.100e+01, 4.000e+01,
        0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [5.900e+01, 7.000e+01, 8.300e+01, 9.600e+01, 1.400e+02, 1.640e+02,
        1.850e+02, 2.110e+02, 1.660e+02, 1.050e+02, 9.100e+01, 6.500e+01,
        0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [4.800e+01, 7.000e+01, 8.300e+01, 9.600e+01, 1.250e+02, 1.830e+02,
        2.060e+02, 2.410e+02, 2.530e+02, 1.850e+02, 1.140e+02, 9.400e+01,
        4.100e+01, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 6.300e+01, 8.300e+01, 9.600e+01, 1.150e+02, 1.890e+02,
        2.310e+02, 2.750e+02, 3.100e+02, 2.750e+02, 2.120e+02, 1.310e+02,
        8.500e+01, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 2.100e+01, 8.000e+01, 1.360e+02, 1.860e+02, 2.550e+02,
        3.310e+02, 4.010e+02, 4.780e+02, 4.230e+02, 3.650e+02, 2.670e+02,
        1.710e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 5.000e+01, 1.320e+02, 1.940e+02, 2.590e+02,
        3.950e+02, 5.130e+02, 6.660e+02, 6.650e+02, 5.620e+02, 4.050e+02,
        2.500e+02, 1.010e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 0.000e+00, 1.110e+02, 1.940e+02, 3.290e+02,
        5.340e+02, 7.780e+02, 9.990e+02, 9.990e+02, 9.880e+02, 6.940e+02,
        3.860e+02, 1.020e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 0.000e+00, 4.000e+01, 1.760e+02, 3.450e+02,
        6.460e+02, 1.242e+03, 1.680e+03, 1.708e+03, 1.706e+03, 1.473e+03,
        8.360e+02, 1.020e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 0.000e+00, 3.700e+01, 8.000e+01, 3.350e+02,
        8.390e+02, 2.000e+03, 3.282e+03, 3.282e+03, 3.280e+03, 3.275e+03,
        3.156e+03, 1.020e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 7.600e+01, 2.970e+02,
        1.001e+03, 2.710e+03, 3.711e+03, 3.716e+03, 3.715e+03, 3.711e+03,
        3.507e+03, 1.000e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 3.870e+02,
        9.940e+02, 2.824e+03, 3.730e+03, 3.734e+03, 3.734e+03, 3.727e+03,
        3.512e+03, 1.640e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00, 6.700e+01, 2.910e+02,
        9.740e+02, 2.686e+03, 3.717e+03, 3.721e+03, 3.721e+03, 3.718e+03,
        3.514e+03, 1.040e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 0.000e+00, 3.400e+01, 7.500e+01, 3.130e+02,
        8.200e+02, 1.956e+03, 3.298e+03, 3.302e+03, 3.301e+03, 3.295e+03,
        3.156e+03, 1.050e+02, 0.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 0.000e+00, 3.400e+01, 1.530e+02, 3.270e+02,
        6.150e+02, 1.200e+03, 1.640e+03, 1.671e+03, 1.670e+03, 1.423e+03,
        8.380e+02, 1.050e+02, 2.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 0.000e+00, 9.000e+01, 1.720e+02, 3.100e+02,
        4.970e+02, 7.380e+02, 9.590e+02, 9.600e+02, 9.520e+02, 6.750e+02,
        3.890e+02, 1.060e+02, 4.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 0.000e+00, 3.300e+01, 1.110e+02, 1.770e+02, 2.400e+02,
        3.550e+02, 4.760e+02, 6.280e+02, 6.250e+02, 5.330e+02, 3.960e+02,
        2.490e+02, 1.060e+02, 4.000e+00, 0.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 1.100e+01, 6.300e+01, 1.160e+02, 1.680e+02, 2.170e+02,
        2.910e+02, 3.610e+02, 4.350e+02, 3.910e+02, 3.450e+02, 2.610e+02,
        1.740e+02, 5.000e+00, 5.000e+00, 4.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [0.000e+00, 4.900e+01, 6.700e+01, 8.200e+01, 1.020e+02, 1.550e+02,
        1.970e+02, 2.410e+02, 2.770e+02, 2.450e+02, 1.850e+02, 1.260e+02,
        8.800e+01, 5.000e+00, 5.000e+00, 4.000e+00, 0.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [3.800e+01, 5.500e+01, 6.900e+01, 8.200e+01, 1.080e+02, 1.490e+02,
        1.720e+02, 2.060e+02, 2.150e+02, 1.580e+02, 9.900e+01, 9.100e+01,
        4.100e+01, 5.000e+00, 5.000e+00, 5.000e+00, 3.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [4.700e+01, 5.500e+01, 6.900e+01, 8.200e+01, 1.120e+02, 1.320e+02,
        1.530e+02, 1.770e+02, 1.380e+02, 8.500e+01, 8.000e+01, 6.500e+01,
        4.000e+00, 5.000e+00, 5.000e+00, 5.000e+00, 4.000e+00, 0.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00],
       [4.700e+01, 5.500e+01, 6.900e+01, 8.000e+01, 1.030e+02, 1.170e+02,
        1.370e+02, 1.240e+02, 6.600e+01, 6.600e+01, 5.800e+01, 3.500e+01,
        4.000e+00, 5.000e+00, 5.000e+00, 5.000e+00, 4.000e+00, 1.000e+00,
        0.000e+00, 0.000e+00, 0.000e+00]])
Y, X = np.meshgrid(x_locs,y_locs)

coord = 250/rotor_diameter
solar_poly = Polygon(((-coord,-coord),(-coord,coord),(coord,coord),(coord,-coord)))

plt.figure(1)

plt.subplot(221)
plt.pcolormesh(X/rotor_diameter,Y/rotor_diameter,totals,vmin=0.85,vmax=1.0)
plot_poly(solar_poly,ax=plt.gca())
cb = plt.colorbar()
cb.ax.tick_params(labelsize=8)
plt.axis("square")
plt.title("yearly energy fraction",fontsize=8)
plt.xlabel("turbine x position (D)",fontsize=8)
plt.ylabel("turbine y position (D)",fontsize=8,labelpad=-1.25)
plt.xticks(fontsize=8)
plt.yticks(fontsize=8)
plt.gca().set_xticks((-5,-4,-3,-2,-1,0,1,2,3,4,5))
plt.gca().set_yticks((-5,-4,-3,-2,-1,0,1,2,3,4,5))

plt.subplot(222)
plt.pcolormesh(X/rotor_diameter,Y/rotor_diameter,maxs,vmin=0.85,vmax=1.0)
plot_poly(solar_poly,ax=plt.gca())
cb = plt.colorbar()
cb.ax.tick_params(labelsize=8)
plt.axis("square")
plt.title("worst case power fraction",fontsize=8)
plt.xlabel("turbine x position (D)",fontsize=8)
plt.ylabel("turbine y position (D)",fontsize=8,labelpad=-1.25)
plt.xticks(fontsize=8)
plt.yticks(fontsize=8)
plt.gca().set_xticks((-5,-4,-3,-2,-1,0,1,2,3,4,5))
plt.gca().set_yticks((-5,-4,-3,-2,-1,0,1,2,3,4,5))

# plt.subplot(223)
# plt.pcolormesh(X/rotor_diameter,Y/rotor_diameter,nums)
# plot_poly(solar_poly,ax=plt.gca())
# plt.colorbar()
# plt.axis("equal")
# plt.title("nums")

plt.subplot(223)
P = np.zeros_like(nums)
lim = 876*2
for k in range(len(P)): 
    P[k] = [1 if element > lim else 0 for element in nums[k]]

import matplotlib as mpl
# define the colors
cmap = mpl.colors.ListedColormap(['white', 'black'])

# create a normalize object the describes the limits of
# each color
bounds = [0., 0.5, 1.]
norm = mpl.colors.BoundaryNorm(bounds, cmap.N)

plt.pcolormesh(X/rotor_diameter,Y/rotor_diameter,P, cmap=cmap, norm=norm)
plot_poly(solar_poly,ax=plt.gca())
cb = plt.colorbar()
cb.ax.tick_params(labelsize=8)
cb.set_ticks([0.25,0.75])
cb.set_ticklabels(["no","yes"])
plt.axis("square")
# plt.title("< 1% diff > 2% of time",fontsize=8)
plt.title("1% or more power difference\nmore than 2% of the time",fontsize=8)
plt.xlabel("turbine x position (D)",fontsize=8)
plt.ylabel("turbine y position (D)",fontsize=8,labelpad=-1.25)
plt.xticks(fontsize=8)
plt.yticks(fontsize=8)
plt.gca().set_xticks((-5,-4,-3,-2,-1,0,1,2,3,4,5))
plt.gca().set_yticks((-5,-4,-3,-2,-1,0,1,2,3,4,5))

plt.subplot(224)
P = np.zeros_like(nums)
lim = 876
for k in range(len(P)): 
    P[k] = [1 if element > lim else 0 for element in nums[k]]
plt.pcolormesh(X/rotor_diameter,Y/rotor_diameter,P, cmap=cmap, norm=norm)
plot_poly(solar_poly,ax=plt.gca())
cb = plt.colorbar()
cb.ax.tick_params(labelsize=8)
cb.set_ticks([0.25,0.75])
cb.set_ticklabels(["no","yes"])
plt.axis("square")
# plt.title("< 1% diff > 1% of time",fontsize=8)
plt.title("1% or more power difference\nmore than 1% of the time",fontsize=8)
plt.xlabel("turbine x position (D)",fontsize=8)
plt.ylabel("turbine y position (D)",fontsize=8,labelpad=-1.25)
plt.xticks(fontsize=8)
plt.yticks(fontsize=8)
plt.gca().set_xticks((-5,-4,-3,-2,-1,0,1,2,3,4,5))
plt.gca().set_yticks((-5,-4,-3,-2,-1,0,1,2,3,4,5))

plt.tight_layout()

plt.savefig("make_figures/figures/shading_stats.pdf",transparent=True)
plt.show()